<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>

  <style>
    body{
      margin:0;
      font-family:Tahoma, Arial;
      background:#020617;
      color:white;
    }

    .container{
      max-width:480px;
      margin:auto;
      padding:20px;
      padding-bottom:120px;
    }

    h1{
      text-align:center;
      color:#facc15;
      margin-bottom:20px;
    }

    .item{
      background:#020617;
      border:1px solid #1e293b;
      border-radius:12px;
      padding:15px;
      margin-bottom:12px;
    }

    .row{
      display:flex;
      justify-content:space-between;
      margin-bottom:6px;
      font-size:14px;
    }

    .type{
      font-weight:bold;
    }

    .plus{ color:#22c55e; }
    .minus{ color:#ef4444; }

    .date{
      font-size:12px;
      opacity:.7;
      margin-top:5px;
      text-align:left;
    }

    .empty{
      text-align:center;
      opacity:.7;
      margin-top:40px;
    }

    /* Bottom menu */
    .menu{
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      background:#020617;
      display:flex;
      justify-content:space-around;
      padding:10px 0;
      border-top:1px solid #1e293b;
    }

    .menu a{
      color:white;
      text-decoration:none;
      font-size:14px;
      text-align:center;
    }

    .menu a span{
      display:block;
      font-size:22px;
    }
  </style>
</head>

<body>

<div class="container">
  <h1>ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h1>

  <div id="list"></div>

  <div id="empty" class="empty" style="display:none">
    Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø¨Ø¹Ø¯
  </div>
</div>

<div class="menu">
  <a href="dashboard.html"><span>ğŸ </span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="ads.html"><span>ğŸ¬</span>Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</a>
  <a href="wallet.html"><span>ğŸ’¼</span>Ù…Ø­ÙØ¸ØªÙŠ</a>
  <a href="account.html"><span>ğŸ‘¤</span>Ø­Ø³Ø§Ø¨ÙŠ</a>
</div>

<script>
async function loadTransactions(){
  const { data:{user} } = await supabase.auth.getUser();
  if(!user){
    window.location.href="login.html";
    return;
  }

  const { data, error } = await supabase
    .from("transactions")
    .select("*")
    .eq("user_id", user.id)
    .order("created_at", { ascending:false });

  const list = document.getElementById("list");

  if(!data || data.length === 0){
    document.getElementById("empty").style.display="block";
    return;
  }

  data.forEach(t=>{
    const div = document.createElement("div");
    div.className="item";

    const amountClass = t.amount >= 0 ? "plus" : "minus";
    const typeText =
      t.type === "ad" ? "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù†" :
      t.type === "deposit" ? "Ø´Ø­Ù†" :
      t.type === "withdraw" ? "Ø³Ø­Ø¨" :
      "Ø¹Ù…Ù„ÙŠØ©";

    div.innerHTML = `
      <div class="row">
        <div class="type">${typeText}</div>
        <div class="${amountClass}">
          ${t.amount > 0 ? "+" : ""}${t.amount} Ù†Ù‚Ø·Ø©
        </div>
      </div>
      <div class="date">
        ${new Date(t.created_at).toLocaleString("ar-EG")}
      </div>
    `;

    list.appendChild(div);
  });
}

loadTransactions();
</script>

</body>
</html>
