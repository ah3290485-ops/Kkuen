<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="mobile.css">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      background:#0b0f1a;
      color:#fff;
      font-family: Tahoma, Arial;
    }
    h1 {
      text-align:center;
      color:gold;
      margin:20px 0;
    }
    table {
      width:100%;
      border-collapse:collapse;
      background:#12182a;
      border-radius:12px;
      overflow:hidden;
      font-size:14px;
    }
    th, td {
      padding:12px;
      text-align:center;
      border-bottom:1px solid #333;
    }
    th {
      color:gold;
      background:#0e1325;
    }
    tr:last-child td {
      border-bottom:none;
    }
    button {
      padding:8px 12px;
      border:none;
      border-radius:8px;
      font-size:14px;
      cursor:pointer;
    }
    .approve {
      background:#16a34a;
      color:#fff;
    }
    .reject {
      background:#dc2626;
      color:#fff;
    }
    .container {
      padding:15px;
      max-width:100%;
    }
  </style>
</head>

<body>

<div class="container">
  <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h1>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
        <th>TXID</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
      </tr>
    </thead>
    <tbody id="depositsTable">
      <tr>
        <td colspan="5">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td>
      </tr>
    </tbody>
  </table>
</div>

<script>
  // ğŸ”¹ Ø¨ÙŠØ§Ù†Ø§Øª Supabase (Ø¬Ø§Ù‡Ø²Ø© Ø¹Ù†Ø¯Ùƒ)
  const SUPABASE_URL = "https://gpfxakuneeuafxgqbobs.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdwZnhha3VuZWV1YWZ4Z3Fib2JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3MzE3ODEsImV4cCI6MjA4MTMwNzc4MX0.x2Mh3LwIg-8peEpJlif_1RcbrA-CyGa-xjtESaYKcXQ";

  const supabase = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
  );

  // ğŸ”¹ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù†
  async function loadDeposits() {
    const { data, error } = await supabase
      .from("deposits")
      .select(`
        id,
        user_id,
        amount,
        txid,
        status,
        created_at,
        profiles(email)
      `)
      .order("created_at", { ascending: false });

    const table = document.getElementById("depositsTable");
    table.innerHTML = "";

    if (error) {
      table.innerHTML = `<tr><td colspan="5">Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>`;
      console.error(error);
      return;
    }

    if (!data || data.length === 0) {
      table.innerHTML = `<tr><td colspan="5">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>`;
      return;
    }

    data.forEach(d => {
      table.innerHTML += `
        <tr>
          <td>${d.profiles?.email || "-"}</td>
          <td>${d.amount}</td>
          <td>${d.txid || "-"}</td>
          <td>${d.status}</td>
          <td>
            ${
              d.status === "pending"
              ? `
                <button class="approve" onclick="approveDeposit('${d.id}')">âœ” Ù…ÙˆØ§ÙÙ‚Ø©</button>
                <button class="reject" onclick="rejectDeposit('${d.id}')">âœ– Ø±ÙØ¶</button>
              `
              : "ØªÙ…"
            }
          </td>
        </tr>
      `;
    });
  }

  // ğŸ”¹ Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø­Ù†
  async function approveDeposit(id) {
    await supabase
      .from("deposits")
      .update({ status: "approved" })
      .eq("id", id);

    loadDeposits();
    alert("ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø­Ù†");
  }

  // ğŸ”¹ Ø±ÙØ¶ Ø§Ù„Ø´Ø­Ù†
  async function rejectDeposit(id) {
    await supabase
      .from("deposits")
      .update({ status: "rejected" })
      .eq("id", id);

    loadDeposits();
    alert("ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø´Ø­Ù†");
  }

  // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
  loadDeposits();
</script>

</body>
</html>
