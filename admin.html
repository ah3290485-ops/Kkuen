<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | BTCUEN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Ø³ØªØ§ÙŠÙ„ Ø£Ø³Ø§Ø³ÙŠ -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="mobile.css">

  <style>
    body {
      background: linear-gradient(135deg, #020617, #020617);
      color: #fff;
      font-family: Tahoma, Arial;
    }
    h1 {
      color: gold;
      text-align: center;
      margin-bottom: 25px;
    }
    .section {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 25px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #1e293b;
      text-align: center;
    }
    th {
      color: gold;
    }
    button {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    .approve { background: #16a34a; color: #fff; }
    .reject { background: #dc2626; color: #fff; }
    .logout {
      background: #334155;
      color: #fff;
      width: 100%;
      padding: 14px;
      font-size: 18px;
      border-radius: 14px;
    }
  </style>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<div class="container">

  <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h1>

  <!-- Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù† -->
  <div class="section">
    <h2>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù†</h2>
    <table id="depositsTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
          <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th>TXID</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ -->
  <div class="section">
    <h2>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨</h2>
    <table id="withdrawalsTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
          <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th>Ø§Ù„Ù…Ø­ÙØ¸Ø©</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
  <div class="section">
    <h2>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
    <table id="usersTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
          <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Ø§Ù„Ø³Ø¬Ù„ -->
  <div class="section">
    <h2>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h2>
    <table id="transactionsTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
          <th>Ø§Ù„Ù†ÙˆØ¹</th>
          <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

</div>

<script>
/* Ø¥Ø¹Ø¯Ø§Ø¯ Supabase */
const supabase = window.supabase.createClient(
  "SUPABASE_URL",
  "SUPABASE_ANON_KEY"
);

const ADMIN_EMAIL = "am.alsus1995@gmail.com";

/* ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ø¯Ù…Ù† */
async function checkAdmin() {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user || user.email !== ADMIN_EMAIL) {
    alert("ğŸš« Ø¯Ø®ÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­");
    window.location.href = "login.html";
  }
}
checkAdmin();

/* ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ */
async function logout() {
  await supabase.auth.signOut();
  window.location.href = "login.html";
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø­Ù† */
async function loadDeposits() {
  const { data } = await supabase
    .from("deposits")
    .select("*")
    .eq("status", "pending");

  const tbody = document.querySelector("#depositsTable tbody");
  tbody.innerHTML = "";

  data.forEach(d => {
    tbody.innerHTML += `
      <tr>
        <td>${d.user_id}</td>
        <td>${d.amount}</td>
        <td>${d.txid}</td>
        <td>${d.status}</td>
        <td>
          <button class="approve" onclick="updateDeposit('${d.id}','approved')">âœ”</button>
          <button class="reject" onclick="updateDeposit('${d.id}','rejected')">âœ–</button>
        </td>
      </tr>`;
  });
}

async function updateDeposit(id, status) {
  await supabase.from("deposits").update({ status }).eq("id", id);
  loadDeposits();
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ */
async function loadWithdrawals() {
  const { data } = await supabase
    .from("withdrawals")
    .select("*")
    .eq("status", "pending");

  const tbody = document.querySelector("#withdrawalsTable tbody");
  tbody.innerHTML = "";

  data.forEach(w => {
    tbody.innerHTML += `
      <tr>
        <td>${w.user_id}</td>
        <td>${w.amount}</td>
        <td>${w.wallet}</td>
        <td>${w.status}</td>
        <td>
          <button class="approve" onclick="updateWithdrawal('${w.id}','approved')">âœ”</button>
          <button class="reject" onclick="updateWithdrawal('${w.id}','rejected')">âœ–</button>
        </td>
      </tr>`;
  });
}

async function updateWithdrawal(id, status) {
  await supabase.from("withdrawals").update({ status }).eq("id", id);
  loadWithdrawals();
}

/* Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */
async function loadUsers() {
  const { data } = await supabase.from("profiles").select("email,points");
  const tbody = document.querySelector("#usersTable tbody");
  tbody.innerHTML = "";
  data.forEach(u => {
    tbody.innerHTML += `
      <tr>
        <td>${u.email}</td>
        <td>${u.points}</td>
      </tr>`;
  });
}

/* Ø§Ù„Ø³Ø¬Ù„ */
async function loadTransactions() {
  const { data } = await supabase
    .from("transactions")
    .select("*")
    .order("created_at", { ascending: false });

  const tbody = document.querySelector("#transactionsTable tbody");
  tbody.innerHTML = "";
  data.forEach(t => {
    tbody.innerHTML += `
      <tr>
        <td>${t.user_id}</td>
        <td>${t.type}</td>
        <td>${t.amount}</td>
        <td>${new Date(t.created_at).toLocaleString()}</td>
      </tr>`;
  });
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„ */
loadDeposits();
loadWithdrawals();
loadUsers();
loadTransactions();
</script>

</body>
</html>
