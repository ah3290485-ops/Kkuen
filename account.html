<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø­Ø³Ø§Ø¨ÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="mobile.css">

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>

<body>

<div class="container">
  <h1>ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ</h1>

  <div class="card">
    <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong></p>
    <div id="userEmail" style="margin-bottom:15px;opacity:.8"></div>

    <p><strong>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</strong></p>
    <input type="password" id="newPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">

    <button class="btn-gold" onclick="changePassword()">ğŸ”’ ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
  </div>

  <div class="card">
    <p><strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</strong></p>
    <p>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</p>
    <div id="userId" class="address"></div>
  </div>

  <button class="btn-dark" onclick="location.href='dashboard.html'">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<div class="menu">
  <a href="dashboard.html"><span>ğŸ </span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="wallet.html"><span>ğŸ’¼</span>Ù…Ø­ÙØ¸ØªÙŠ</a>
  <a href="transactions.html"><span>ğŸ“œ</span>Ø§Ù„Ø³Ø¬Ù„</a>
  <a href="withdraw.html"><span>ğŸ’¸</span>Ø³Ø­Ø¨</a>
</div>

<script src="supabase.js"></script>
<script>
async function loadAccount() {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    location.href = "login.html";
    return;
  }

  document.getElementById("userEmail").innerText = user.email;
  document.getElementById("userId").innerText = user.id;
}

async function changePassword() {
  const newPassword = document.getElementById("newPassword").value;

  if (!newPassword || newPassword.length < 6) {
    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
    return;
  }

  const { error } = await supabase.auth.updateUser({
    password: newPassword
  });

  if (error) {
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«");
  } else {
    alert("âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­");
    document.getElementById("newPassword").value = "";
  }
}

loadAccount();
</script>

</body>
</html>
