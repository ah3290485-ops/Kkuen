<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>طلب سحب</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="mobile.css">

  <style>
    body{
      background:linear-gradient(135deg,#050814,#0b1226);
      font-family:Arial;
      color:#fff;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      margin:0;
    }
    .box{
      width:90%;
      max-width:400px;
      background:#0d132b;
      padding:25px;
      border-radius:16px;
      box-shadow:0 0 20px rgba(255,215,0,.25);
    }
    h2{color:gold;text-align:center;margin-bottom:20px;}
    input{
      width:100%;
      padding:14px;
      margin-bottom:15px;
      border-radius:12px;
      border:none;
      font-size:16px;
    }
    button{
      width:100%;
      padding:14px;
      background:gold;
      color:#000;
      font-weight:bold;
      border:none;
      border-radius:14px;
      font-size:18px;
      cursor:pointer;
    }
    .back{
      margin-top:12px;
      text-align:center;
      font-size:14px;
    }
    .back a{color:gold;text-decoration:none;}
  </style>
</head>

<body>

<div class="box">
  <h2>طلب سحب</h2>

  <input type="number" id="amount" placeholder="المبلغ">
  <input type="text" id="wallet" placeholder="عنوان المحفظة">

  <button onclick="sendWithdraw()">إرسال طلب السحب</button>

  <div class="back">
    <a href="/Kkuen/dashboard.html">رجوع للوحة التحكم</a>
  </div>
</div>

<script>
  const SUPABASE_URL = "https://gpfxakuneeuafxgqbobs.supabase.co";
  const SUPABASE_ANON_KEY = "PUT_YOUR_ANON_KEY_HERE";

  const supabase = supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );

  async function sendWithdraw(){
    const amount = document.getElementById("amount").value;
    const wallet = document.getElementById("wallet").value;

    if(!amount || !wallet){
      alert("يرجى تعبئة جميع الحقول");
      return;
    }

    const { data:{ user } } = await supabase.auth.getUser();
    if(!user){
      window.location.href="/Kkuen/login.html";
      return;
    }

    const { error } = await supabase
      .from("withdrawals")
      .insert([{
        user_id: user.id,
        amount: amount,
        wallet: wallet,
        status: "pending"
      }]);

    if(error){
      alert("خطأ: " + error.message);
    }else{
      alert("تم إرسال طلب السحب ✔️");
      window.location.href="/Kkuen/dashboard.html";
    }
  }
</script>

</body>
</html>
