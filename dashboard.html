
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<style>
body{
  margin:0;
  font-family: Arial;
  background: linear-gradient(135deg,#020617,#0f172a);
  color:white;
}

/* container */
.container{
  padding:20px;
  max-width:420px;
  margin:auto;
}

/* card */
.card{
  background:#020617;
  border-radius:14px;
  padding:20px;
  text-align:center;
  box-shadow:0 0 15px rgba(0,0,0,.6);
}

.balance{
  font-size:40px;
  margin:15px 0;
  color:#facc15;
}

/* buttons */
button{
  width:100%;
  padding:14px;
  margin:8px 0;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
}

.btn-gold{
  background:#facc15;
  color:black;
  font-weight:bold;
}

.btn-dark{
  background:#1e293b;
  color:white;
}

button:disabled{
  opacity:.6;
}

/* menu bottom */
.menu{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#020617;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
  border-top:1px solid #1e293b;
}

.menu a{
  color:white;
  text-decoration:none;
  font-size:14px;
  text-align:center;
}

.menu a span{
  display:block;
  font-size:22px;
}

#timer{
  margin-top:10px;
  font-size:18px;
}
</style>
</head>

<body>

<div class="container">
  <h1>BTCUENE</h1>
  <div id="userEmail" style="opacity:.8"></div>

  <div class="card">
    <div>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù†Ù‚Ø§Ø·)</div>
    <div class="balance" id="points">0</div>

    <button class="btn-gold" id="watchAdBtn">
      ğŸ¬ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† (+1 Ù†Ù‚Ø·Ø©)
    </button>

    <div id="timer"></div>

    <button class="btn-dark" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</div>

<!-- menu -->
<div class="menu">
  <a href="dashboard.html"><span>ğŸ </span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="ads.html"><span>ğŸ¬</span>Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</a>
  <a href="wallet.html"><span>ğŸ’¼</span>Ù…Ø­ÙØ¸ØªÙŠ</a>
  <a href="account.html"><span>ğŸ‘¤</span>Ø­Ø³Ø§Ø¨ÙŠ</a>
</div>

<script>
let watching = false;

/* ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
async function loadUser(){
  const { data:{ user } } = await supabase.auth.getUser();
  if(!user){
    location.href="login.html";
    return;
  }

  document.getElementById("userEmail").innerText = user.email;

  const { data } = await supabase
    .from("profiles")
    .select("points")
    .eq("user_id", user.id)
    .single();

  document.getElementById("points").innerText = data?.points || 0;
}

loadUser();

/* Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† */
document.getElementById("watchAdBtn").onclick = watchAd;

async function watchAd(){
  if(watching) return;
  watching = true;

  let seconds = 10;
  const timer = document.getElementById("timer");
  const btn = document.getElementById("watchAdBtn");

  btn.disabled = true;
  timer.innerText = "â³ " + seconds + " Ø«ÙˆØ§Ù†ÙŠ";

  const interval = setInterval(async ()=>{
    seconds--;
    timer.innerText = "â³ " + seconds + " Ø«ÙˆØ§Ù†ÙŠ";

    if(seconds <= 0){
      clearInterval(interval);
      timer.innerText = "âœ… ØªÙ… Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†";
      btn.disabled = false;
      watching = false;
      await rewardUser();
    }
  },1000);
}

/* Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© + Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ© */
async function rewardUser(){
  const { data:{ user } } = await supabase.auth.getUser();

  await supabase.rpc("increment_points",{
    uid:user.id,
    amount:1
  });

  await supabase.from("transactions").insert({
    user_id:user.id,
    type:"ad",
    amount:1
  });

  loadUser();
}

/* ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ */
async function logout(){
  await supabase.auth.signOut();
  location.href="login.html";
}
</script>

</body>
</html>
